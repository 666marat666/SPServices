/*
 * SPServices - Work with SharePoint's Web Services using jQuery
 * Version 0.4.6
 * @requires jQuery v1.3.2
 *
 * Copyright (c) 2009 Sympraxis Consulting LLC
 * Examples and docs at:
 * http://spservices.codeplex.com
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/mit-license.php
 */
/**
 * @description Work with SharePoint's Web Services using jQuery
 * @type jQuery
 * @name SPServices
 * @category Plugins/SPServices
 * @author Sympraxis Consulting LLC/marc.anderson@sympraxisconsulting.com
 */
(function(c){var p=new Array();p.Alerts="Alerts";p.Authentication="Authentication";p.Copy="Copy";p.Forms="Forms";p.Lists="Lists";p.Permissions="Permissions";p.PublishedLinksService="PublishedLinksService";p.Search="Search";p.usergroup="usergroup";p.UserProfileService="UserProfileService";p.Views="Views";p.Versions="Versions";p.WebPartPages="WebPartPages";p.Webs="Webs";p.Workflow="Workflow";var b=new Array();b.GetAlerts=p.Alerts;b.DeleteAlerts=p.Alerts;b.Mode=p.Authentication;b.Login=p.Authentication;b.CopyIntoItemsLocal=p.Copy;b.GetForm=p.Forms;b.GetFormCollection=p.Forms;b.AddList=p.Lists;b.CheckInFile=p.Lists;b.CheckOutFile=p.Lists;b.DeleteList=p.Lists;b.GetAttachmentCollection=p.Lists;b.GetList=p.Lists;b.GetListAndView=p.Lists;b.GetListCollection=p.Lists;b.GetListItems=p.Lists;b.UpdateList=p.Lists;b.UpdateListItems=p.Lists;b.GetPermissionCollection=p.Permissions;b.GetLinks=p.PublishedLinksService;b.GetPortalSearchInfo=p.Search;b.GetSearchMetadata=p.Search;b.Query=p.Search;b.Status=p.Search;b.AddGroup=p.usergroup;b.AddGroupToRole=p.usergroup;b.AddRole=p.usergroup;b.GetAllUserCollectionFromWeb=p.usergroup;b.GetGroupCollection=p.usergroup;b.GetGroupCollectionFromRole=p.usergroup;b.GetGroupCollectionFromSite=p.usergroup;b.GetGroupCollectionFromUser=p.usergroup;b.GetGroupCollectionFromWeb=p.usergroup;b.GetGroupInfo=p.usergroup;b.GetRoleCollection=p.usergroup;b.GetRoleCollectionFromGroup=p.usergroup;b.GetRoleCollectionFromUser=p.usergroup;b.GetRoleCollectionFromWeb=p.usergroup;b.GetRolesAndPermissionsForCurrentUser=p.usergroup;b.GetRolesAndPermissionsForSite=p.usergroup;b.GetUserCollection=p.usergroup;b.GetUserCollectionFromGroup=p.usergroup;b.GetUserCollectionFromRole=p.usergroup;b.GetUserCollectionFromSite=p.usergroup;b.GetUserCollectionFromWeb=p.usergroup;b.GetUserInfo=p.usergroup;b.GetUserLoginFromEmail=p.usergroup;b.RemoveGroup=p.usergroup;b.GetCommonMemberships=p.UserProfileService;b.GetUserColleagues=p.UserProfileService;b.GetUserLinks=p.UserProfileService;b.GetUserMemberships=p.UserProfileService;b.GetUserPinnedLinks=p.UserProfileService;b.GetUserProfileByName=p.UserProfileService;b.GetUserProfileCount=p.UserProfileService;b.GetUserProfileSchema=p.UserProfileService;b.GetViewCollection=p.Views;b.DeleteAllVersions=p.Versions;b.DeleteVersion=p.Versions;b.GetVersions=p.Versions;b.RestoreVersion=p.Versions;b.GetWebPart2=p.WebPartPages;b.GetWebPartPage=p.WebPartPages;b.GetWebPartProperties=p.WebPartPages;b.GetWebPartProperties2=p.WebPartPages;b.GetListTemplates=p.Webs;b.GetWeb=p.Webs;b.GetWebCollection=p.Webs;b.GetAllSubWebCollection=p.Webs;b.WebUrlFromPageUrl=p.Webs;b.GetTemplatesForItem=p.Workflow;b.GetToDosForItem=p.Workflow;b.GetWorkflowDataForItem=p.Workflow;b.GetWorkflowTaskData=p.Workflow;b.StartWorkflow=p.Workflow;var g=new Object();g.header="<soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body>";g.footer="</soap:Body></soap:Envelope>";g.payload="";c.fn.SPServices=function(u){var v=c.extend({},c.fn.SPServices.defaults,u);g.opheader="<"+v.operation+" ";switch(b[v.operation]){case p.Alerts:g.opheader+="xmlns='http://schemas.microsoft.com/sharepoint/soap/2002/1/alerts/' >";SOAPAction="http://schemas.microsoft.com/sharepoint/soap/2002/1/alerts/";break;case p.Permissions:g.opheader+="xmlns='http://schemas.microsoft.com/sharepoint/soap/directory/' >";SOAPAction="http://schemas.microsoft.com/sharepoint/soap/directory/";break;case p.PublishedLinksService:g.opheader+="xmlns='http://microsoft.com/webservices/SharePointPortalServer/PublishedLinksService/' >";SOAPAction="http://microsoft.com/webservices/SharePointPortalServer/PublishedLinksService/";break;case p.Search:g.opheader+="xmlns='urn:Microsoft.Search' >";SOAPAction="urn:Microsoft.Search/";break;case p.usergroup:g.opheader+="xmlns='http://schemas.microsoft.com/sharepoint/soap/directory/' >";SOAPAction="http://schemas.microsoft.com/sharepoint/soap/directory/";break;case p.UserProfileService:g.opheader+="xmlns='http://microsoft.com/webservices/SharePointPortalServer/UserProfileService' >";SOAPAction="http://microsoft.com/webservices/SharePointPortalServer/UserProfileService/";break;case p.WebPartPages:g.opheader+="xmlns='http://microsoft.com/sharepoint/webpartpages' >";SOAPAction="http://microsoft.com/sharepoint/webpartpages/";break;case p.Workflow:g.opheader+="xmlns='http://schemas.microsoft.com/sharepoint/soap/workflow/' >";SOAPAction="http://schemas.microsoft.com/sharepoint/soap/workflow/";break;default:g.opheader+="xmlns='http://schemas.microsoft.com/sharepoint/soap/'>";SOAPAction="http://schemas.microsoft.com/sharepoint/soap/";break}SOAPAction+=v.operation;g.opfooter="</"+v.operation+">";var w=((v.webURL!="")?v.webURL:c().SPServices.SPGetCurrentSite())+"/_vti_bin/"+b[v.operation]+".asmx";g.payload="";switch(v.operation){case"GetAlerts":break;case"DeleteAlerts":g.payload+="<IDs>";for(i=0;i<v.IDs.length;i++){g.payload+=d("string",v.IDs[i])}g.payload+="</IDs>";break;case"Mode":break;case"Login":g.payload+=d("username",v.username);g.payload+=d("password",v.password);break;case"CopyIntoItemsLocal":g.payload+=d("SourceUrl",v.SourceUrl);g.payload+="<DestinationUrls>";for(i=0;i<v.DestinationUrls.length;i++){g.payload+=d("string",v.DestinationUrls[i])}g.payload+="</DestinationUrls>";break;case"GetForm":g.payload+=d("listName",v.listName);g.payload+=d("formUrl",v.formUrl);break;case"GetFormCollection":g.payload+=d("listName",v.listName);break;case"AddList":g.payload+=d("listName",v.listName);g.payload+=d("description",v.description);g.payload+=d("templateID",v.templateID);break;case"CheckInFile":g.payload+=d("pageUrl",v.pageUrl);g.payload+=d("comment",v.comment);g.payload+=d("CheckinType",v.CheckinType);break;case"CheckOutFile":g.payload+=d("pageUrl",v.pageUrl);g.payload+=d("checkoutToLocal",v.checkoutToLocal);g.payload+=d("lastmodified",v.lastmodified);break;case"DeleteList":g.payload+=d("listName",v.listName);break;case"GetAttachmentCollection":g.payload+=d("listName",v.listName);g.payload+=d("listItemID",v.ID);break;case"GetList":g.payload+=d("listName",v.listName);break;case"GetListAndView":g.payload+=d("listName",v.listName);g.payload+=d("viewName",v.viewName);break;case"GetListCollection":break;case"GetListItems":g.payload+=d("listName",v.listName);g.payload+=d("viewFields",v.CAMLViewFields);g.payload+=d("query",v.CAMLQuery);g.payload+=d("rowLimit",v.CAMLRowLimit);g.payload+=d("queryOptions",v.CAMLQueryOptions);break;case"UpdateList":g.payload+=d("listName",v.listName);g.payload+=d("listProperties",v.listProperties);g.payload+=d("newFields",v.newFields);g.payload+=d("updateFields",v.updateFields);g.payload+=d("deleteFields",v.deleteFields);g.payload+=d("listVersion",v.listVersion);break;case"UpdateListItems":g.payload+=d("listName",v.listName);if(v.updates.length>0){g.payload+=d("updates",v.updates)}else{g.payload+="<updates><Batch OnError='Continue'><Method ID='1' Cmd='"+v.batchCmd+"'>";for(i=0;i<v.valuepairs.length;i++){g.payload+="<Field Name='"+v.valuepairs[i][0]+"'>"+v.valuepairs[i][1]+"</Field>"}g.payload+="<Field Name='ID'>"+v.ID+"</Field>";g.payload+="</Method></Batch></updates>"}break;case"GetPermissionCollection":g.payload+=d("objectName",v.objectName);g.payload+=d("objectType",v.objectType);break;case"GetLinks":break;case"GetPortalSearchInfo":SOAPAction="http://microsoft.com/webservices/OfficeServer/QueryService/"+v.operation;g.opheader="<"+v.operation+" xmlns='http://microsoft.com/webservices/OfficeServer/QueryService'/>";break;case"GetSearchMetadata":SOAPAction="http://microsoft.com/webservices/OfficeServer/QueryService/"+v.operation;g.opheader="<"+v.operation+" xmlns='http://microsoft.com/webservices/OfficeServer/QueryService'/>";break;case"Query":g.payload+=d("queryXml",l(v.queryXml));break;case"Status":break;case"AddGroup":g.payload+=d("groupName",v.groupName);g.payload+=d("ownerIdentifier",v.ownerIdentifier);g.payload+=d("ownerType",v.ownerType);g.payload+=d("defaultUserLoginName",v.defaultUserLoginName);g.payload+=d("groupName",v.groupName);g.payload+=d("description",v.description);break;case"AddGroupToRole":g.payload+=d("groupName",v.groupName);g.payload+=d("roleName",v.roleName);break;case"AddRole":g.payload+=d("roleName",v.roleName);g.payload+=d("description",v.description);g.payload+=d("permissionMask",v.permissionMask);break;case"GetAllUserCollectionFromWeb":break;case"GetGroupCollectionFromRole":g.payload+=d("roleName",v.roleName);break;case"GetGroupCollection":g.payload+=d("groupNamesXml",v.groupNamesXml);break;case"GetGroupCollectionFromSite":break;case"GetGroupCollectionFromUser":g.payload+=d("userLoginName",v.userLoginName);break;case"GetGroupCollectionFromWeb":break;case"GetGroupInfo":g.payload+=d("groupName",v.groupName);break;case"GetRoleCollection":g.payload+=d("roleNamesXml",v.roleNamesXml);break;case"GetRoleCollectionFromGroup":g.payload+=d("groupName",v.groupName);break;case"GetRoleCollectionFromUser":g.payload+=d("userLoginName",v.userLoginName);break;case"GetRoleCollectionFromWeb":break;case"GetRoleInfo":g.payload+=d("roleName",v.roleName);break;case"GetRolesAndPermissionsForCurrentUser":break;case"GetRolesAndPermissionsForSite":break;case"GetUserCollection":g.payload+=d("userLoginNamesXml",v.userLoginNamesXml);break;case"GetUserCollectionFromGroup":g.payload+=d("groupName",v.groupName);break;case"GetUserCollectionFromRole":g.payload+=d("roleName",v.roleName);break;case"GetUserCollectionFromSite":break;case"GetUserCollectionFromWeb":break;case"GetUserInfo":g.payload+=d("userLoginName",v.userLoginName);break;case"GetUserLoginFromEmail":g.payload+=d("emailXml",v.emailXml);break;case"RemoveGroup":g.payload+=d("groupName",v.groupName);break;case"GetCommonMemberships":g.payload+=d("accountName",v.accountName);break;case"GetUserColleagues":g.payload+=d("accountName",v.accountName);break;case"GetUserLinks":g.payload+=d("accountName",v.accountName);break;case"GetUserMemberships":g.payload+=d("accountName",v.accountName);break;case"GetUserPinnedLinks":g.payload+=d("accountName",v.accountName);break;case"GetUserProfileByName":if(v.accountName.length>0){g.payload+=d("AccountName",v.accountName)}else{g.payload+=d("AccountName",v.AccountName)}break;case"GetUserProfileCount":break;case"GetUserProfileSchema":break;case"GetViewCollection":g.payload+=d("listName",v.listName);break;case"DeleteAllVersions":g.payload+=d("fileName",v.fileName);break;case"DeleteVersion":g.payload+=d("fileName",v.fileName);g.payload+=d("fileVersion",v.fileVersion);break;case"GetVersions":g.payload+=d("fileName",v.fileName);break;case"RestoreVersion":g.payload+=d("fileName",v.fileName);g.payload+=d("fileVersion",v.fileVersion);break;case"GetWebPart2":g.payload+=d("pageUrl",v.pageUrl);g.payload+=d("storageKey",v.storageKey);g.payload+=d("storage",v.storage);g.payload+=d("behavior",v.behavior);break;case"GetWebPartPage":g.payload+=d("documentName",v.documentName);g.payload+=d("behavior",v.behavior);break;case"GetWebPartProperties":g.payload+=d("pageUrl",v.pageUrl);g.payload+=d("storage",v.storage);break;case"GetWebPartProperties2":g.payload+=d("pageUrl",v.pageUrl);g.payload+=d("storage",v.storage);g.payload+=d("behavior",v.behavior);break;case"GetWeb":g.payload+=d("webUrl",v.webURL);break;case"GetListTemplates":break;case"GetWebCollection":break;case"GetAllSubWebCollection":break;case"WebUrlFromPageUrl":g.payload+=d("pageUrl",v.pageURL);break;case"GetTemplatesForItem":g.payload+=d("item",v.item);break;case"GetToDosForItem":g.payload+=d("item",v.item);break;case"GetWorkflowDataForItem":g.payload+=d("item",v.item);break;case"GetWorkflowTaskData":g.payload+=d("item",v.item);g.payload+=d("listId",v.listId);g.payload+=d("taskId",v.taskId);break;case"StartWorkflow":g.payload+=d("item",v.item);g.payload+=d("templateId",v.templateId);g.payload+=d("workflowParameters",v.workflowParameters);break;default:break}var x=g.header+g.opheader+g.payload+g.opfooter+g.footer;c.ajax({url:w,async:v.async,beforeSend:function(y){y.setRequestHeader("SOAPAction",SOAPAction)},type:"POST",data:x,dataType:"xml",contentType:"text/xml; charset='utf-8'",complete:v.completefunc})};c.fn.SPServices.defaults={operation:"",webURL:"",pageURL:"",listName:"",description:"",templateID:"",viewName:"",formUrl:"",fileName:"",fileVersion:"",ID:1,updates:"",comment:"",CheckinType:"",checkoutToLocal:"",lastmodified:"",CAMLViewName:"",CAMLQuery:"",CAMLViewFields:"",CAMLRowLimit:0,CAMLQueryOptions:"<QueryOptions></QueryOptions>",batchCmd:"Update",valuepairs:[],listProperties:"",newFields:"",updateFields:"",deleteFields:"",listVersion:"",username:"",password:"",accountName:"",AccountName:"",userLoginName:"",groupNamesXml:"",groupName:"",ownerIdentifier:"",ownerType:"",defaultUserLoginName:"",roleNamesXml:"",roleName:"",permissionMask:"",userLoginNamesXml:"",emailXml:"",objectName:"",objectType:"List",IDs:null,SourceUrl:"",DestinationUrls:[],documentName:"",behavior:"Version3",storageKey:"",storage:"Shared",item:"",listId:"",taskId:"",templateId:"",workflowParameters:"",fClaim:false,queryXml:"",async:true,completefunc:null};c.fn.SPServices.SPGetCurrentSite=function(){var u="";var v=g.header+"<WebUrlFromPageUrl xmlns='http://schemas.microsoft.com/sharepoint/soap/' ><pageUrl>"+((location.href.indexOf("?")>0)?location.href.substr(0,location.href.indexOf("?")):location.href)+"</pageUrl></WebUrlFromPageUrl>"+g.footer;c.ajax({async:false,url:"/_vti_bin/Webs.asmx",beforeSend:function(w){w.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/WebUrlFromPageUrl")},type:"POST",data:v,dataType:"xml",contentType:'text/xml; charset="utf-8"',complete:function(x,w){u=c(x.responseXML).find("WebUrlFromPageUrlResult").text()}});return u};c.fn.SPServices.SPCascadeDropdowns=function(u){var w=c.extend({},{relationshipWebURL:"",relationshipList:"",relationshipListParentColumn:"",relationshipListChildColumn:"",relationshipListSortColumn:"",parentColumn:"",childColumn:"",CAMLQuery:"",debug:false},u);var v=new f(w.parentColumn);if(v.Obj.html()==null&&w.debug){e("SPServices.SPCascadeDropdowns","parentColumn: "+w.parentColumn,"Column not found on page");return}switch(v.Type){case"S":v.Obj.bind("change",function(){s(w)});v.Obj.change();break;case"C":v.Obj.bind("propertychange",function(){s(w)});v.Obj.trigger("propertychange");break;case"M":if(w.debug){e("SPServices.SPCascadeDropdowns","parentColumn: "+w.parentColumn,"Multi-select columns not yet supported by this function")}break;default:break}};function s(x){var E="";var B=null;var z=null;var w;var C;var D;var A=new f(x.parentColumn);switch(A.Type){case"S":z=A.Obj.find("option:selected").text();break;case"C":z=A.Obj.attr("value");break;case"M":break;default:break}if(A.Obj.attr("cascadeDropdownSelected_"+x.childColumn)==z){return}A.Obj.attr("cascadeDropdownSelected_"+x.childColumn,z);var v=new f(x.childColumn);if(v.Obj.html()==null&&x.debug){e("SPServices.SPCascadeDropdowns","childColumn: "+x.childColumn,"Column not found on page");return}switch(v.Type){case"S":B=v.Obj.find("option:selected").val();break;case"C":B=v.Obj.attr("value");break;case"M":C=v.Obj.closest("span").find("input:[name$='MultiLookupPicker$data']");w=window[v.Obj.closest("tr").find("button:[id$='AddButton']").attr("id").replace(/AddButton/,"MultiLookupPicker_m")];currentSelection=v.Obj.closest("span").find("select:[Title='"+x.childColumn+" selected values']");w.data="";break;default:break}var y=(x.relationshipListSortColumn.length>0)?x.relationshipListSortColumn:x.relationshipListChildColumn;var u="<Query><OrderBy><FieldRef Name='"+y+"'/></OrderBy><Where>";if(x.CAMLQuery.length>0){u+="<And>"}u+="<Eq><FieldRef Name='"+x.relationshipListParentColumn+"'/><Value Type='Text'>"+z+"</Value></Eq>";if(x.CAMLQuery.length>0){u+=x.CAMLQuery+"</And>"}u+="</Where></Query>";c().SPServices({operation:"GetListItems",async:false,webURL:x.relationshipWebURL,listName:x.relationshipList,CAMLQuery:u,CAMLViewFields:"<ViewFields><FieldRef Name='"+x.relationshipListParentColumn+"' /><FieldRef Name='"+x.relationshipListChildColumn+"' /></ViewFields>",CAMLRowLimit:0,completefunc:function(G,F){c(G.responseXML).find("faultcode").each(function(){if(x.debug){e("SPServices.SPCascadeDropdowns","relationshipListParentColumn: "+x.relationshipListParentColumn+" or relationshipListChildColumn: "+x.relationshipListChildColumn,"Not found in relationshipList "+x.relationshipList)}return});switch(v.Type){case"S":v.Obj.attr({length:0}).append("<option value='0'>Choose "+x.childColumn+"...</option>");break;case"C":E="(None)|0";v.Obj.attr("value","");break;case"M":v.Obj.attr({length:0});D="";break;default:break}c(G.responseXML).find("[nodeName=z:row]").each(function(){var H=(c(this).attr("ows_"+x.relationshipListChildColumn).indexOf(";#")>0)?c(this).attr("ows_"+x.relationshipListChildColumn).split(";#")[1]:c(this).attr("ows_"+x.relationshipListChildColumn);switch(v.Type){case"S":var I=(c(this).attr("ows_ID")==B)?" selected='selected'":"";v.Obj.append("<option"+I+" value='"+c(this).attr("ows_ID")+"'>"+H+"</option>");break;case"C":if(H==B){v.Obj.attr("value",B)}E=E+"|"+H+"|"+c(this).attr("ows_ID");break;case"M":v.Obj.append("<option value='"+c(this).attr("ows_ID")+"'>"+c(this).attr("ows_"+x.relationshipListChildColumn)+"</option>");D+=c(this).attr("ows_ID")+"|t"+c(this).attr("ows_"+x.relationshipListChildColumn)+"|t |t |t";break;default:break}});switch(v.Type){case"S":v.Obj.trigger("change");break;case"C":v.Obj.attr("choices",E);v.Obj.trigger("propertychange");break;case"M":C.attr("value",D);c(currentSelection).find("option").each(function(){var H=c(this);c(this).attr("selected","selected");c(v.Obj).find("option").each(function(){if(c(this).html()==H.html()){H.attr("selected","")}})});GipRemoveSelectedItems(w);c(v.Obj).find("option").each(function(){var H=c(this);c(currentSelection).find("option").each(function(){if(c(this).html()==H.html()){H.remove()}})});GipAddSelectedItems(w);w.data=GipGetGroupData(D);break;default:break}}})}c.fn.SPServices.SPDisplayRelatedInfo=function(u){var v=c.extend({},{columnName:"",relatedWebURL:"",relatedList:"",relatedListColumn:"",relatedColumns:[],displayFormat:"table",headerCSSClass:"ms-vh2",rowCSSClass:"ms-vb",CAMLQuery:"",debug:false},u);var w=new f(v.columnName);if(w.Obj.html()==null&&v.debug){e("SPServices.SPDisplayRelatedInfo","columnName: "+v.columnName,"Column not found on page");return}switch(w.Type){case"S":w.Obj.bind("change",function(){t(v)});w.Obj.change();break;case"C":w.Obj.bind("propertychange",function(){t(v)});w.Obj.trigger("propertychange");break;case"M":if(v.debug){e("SPServices.SPDisplayRelatedInfo","columnName: "+v.columnName,"Multi-select columns not supported by this function")}break;default:break}};function t(z){var v=null;var A=new f(z.columnName);switch(A.Type){case"S":v=A.Obj.find("option:selected").text();break;case"C":v=A.Obj.attr("value");break;case"M":break;default:break}if(A.Obj.attr("showRelatedSelected")==v){return}A.Obj.attr("showRelatedSelected",v);var x="showRelated_"+q(z.columnName);c("#"+x).remove();A.Obj.parent().append("<div id="+x+"></div>");var y=[];c().SPServices({operation:"GetList",async:false,webURL:z.relatedWebURL,listName:z.relatedList,completefunc:function(C,B){c(C.responseXML).find("faultcode").each(function(){if(z.debug){e("SPServices.SPDisplayRelatedInfo","relatedList: "+z.relatedList,"List not found")}return});c(C.responseXML).find("Fields").each(function(){c(C.responseXML).find("Field").each(function(){for(i=0;i<z.relatedColumns.length;i++){if(c(this).attr("Name")==z.relatedColumns[i]){y[i]=c(this)}}})})}});var u="<Query><Where>";if(z.CAMLQuery.length>0){u+="<And>"}u+="<Eq><FieldRef Name='"+z.relatedListColumn+"'/><Value Type='Text'>"+v+"</Value></Eq>";if(z.CAMLQuery.length>0){u+=z.CAMLQuery+"</And>"}u+="</Where></Query>";var w=" ";for(i=0;i<z.relatedColumns.length;i++){w+="<FieldRef Name='"+z.relatedColumns[i]+"' />"}c().SPServices({operation:"GetListItems",async:false,webURL:z.relatedWebURL,listName:z.relatedList,CAMLQuery:u,CAMLViewFields:"<ViewFields>"+w+"</ViewFields>",CAMLRowLimit:0,completefunc:function(D,C){c(D.responseXML).find("faultcode").each(function(){if(z.debug){e("SPServices.SPDisplayRelatedInfo","relatedListColumn: "+z.relatedListColumn,"Column not found in relatedList "+z.relatedList)}return});switch(z.displayFormat){case"table":var B="<table>";B+="<tr>";for(i=0;i<z.relatedColumns.length;i++){B+="<th class='"+z.headerCSSClass+"'>"+y[i].attr("DisplayName")+"</th>"}B+="</tr>";c(D.responseXML).find("[nodeName=z:row]").each(function(){B+="<tr>";for(i=0;i<z.relatedColumns.length;i++){B+="<td class='"+z.rowCSSClass+"'>"+r(y[i],c(this).attr("ows_"+z.relatedColumns[i]),z)+"</td>"}B+="</tr>"});B+="</table>";c("#showRelated_"+q(z.columnName)).html("").append(B);break;case"list":var B="<table>";for(i=0;i<z.relatedColumns.length;i++){c(D.responseXML).find("[nodeName=z:row]").each(function(){B+="<tr>";B+="<th class='"+z.headerCSSClass+"'>"+y[i].attr("DisplayName")+"</th>";B+="<td class='"+z.rowCSSClass+"'>"+r(y[i],c(this).attr("ows_"+z.relatedColumns[i]),z)+"</td>";B+="</tr>"})}B+="</table>";c("#showRelated_"+q(z.columnName)).html("").append(B);break;default:break}}})}c.fn.SPServices.SPDebugXMLHttpResult=function(v){var x=c.extend({},{node:null,indent:0},v);var z=3;var y=4;var u="";u+="<table class='ms-vb' style='margin-left:"+x.indent*3+"px;' width='100%'>";if(x.node.nodeName=="DisplayPattern"){u+="<tr><td width='100px' style='font-weight:bold;'>"+x.node.nodeName+"</td><td><textarea readonly='readonly' rows='5' cols='50'>"+x.node.xml+"</textarea></td></tr>"}else{if(!x.node.hasChildNodes()){u+="<tr><td width='100px' style='font-weight:bold;'>"+x.node.nodeName+"</td><td>"+((x.node.nodeValue!=null)?n(x.node.nodeValue):"&nbsp;")+"</td></tr>";if(x.node.attributes){u+="<tr><td colspan='99'>";u+=a(x.node,x);u+="</td></tr>"}}else{if(x.node.hasChildNodes()&&x.node.firstChild.nodeType==y){u+="<tr><td width='100px' style='font-weight:bold;'>"+x.node.nodeName+"</td><td><textarea readonly='readonly' rows='5' cols='50'>"+x.node.parentNode.text+"</textarea></td></tr>"}else{if(x.node.hasChildNodes()&&x.node.firstChild.nodeType==z){u+="<tr><td width='100px' style='font-weight:bold;'>"+x.node.nodeName+"</td><td>"+n(x.node.firstChild.nodeValue)+"</td></tr>"}else{u+="<tr><td width='100px' style='font-weight:bold;' colspan='99'>"+x.node.nodeName+"</td></tr>";if(x.node.attributes){u+="<tr><td colspan='99'>";u+=a(x.node,x);u+="</td></tr>"}u+="<tr><td>";for(var w=0;w<x.node.childNodes.length;w++){u+=c().SPServices.SPDebugXMLHttpResult({node:x.node.childNodes.item(w),indent:x.indent+1})}u+="</td></tr>"}}}}u+="</table>";return u};c.fn.SPServices.SPGetCurrentUser=function(){var u="";c.ajax({async:false,url:"/_layouts/userdisp.aspx?Force=True",complete:function(w,v){c(w.responseText).find("table.ms-formtable td#SPFieldText").each(function(){if(/FieldInternalName=\"Name\"/.test(c(this).html())){u=c(this).text()}})}});return u.replace(/(^[\s\xA0]+|[\s\xA0]+$)/g,"")};c.fn.SPServices.SPLookupAddNew=function(w){var x=c.extend({},{lookupColumn:"",promptText:"Add new {0}",debug:false},w);var v=new f(x.lookupColumn);if(v.Obj.html()==null&&x.debug){e("SPServices.SPLookupAddNew","lookupColumn: "+x.lookupColumn,"Column not found on page");return}var y="";var u="";c().SPServices({operation:"GetList",async:false,listName:o(),completefunc:function(A,z){c(A.responseXML).find("Field").each(function(){if(c(this).attr("DisplayName")==x.lookupColumn){c().SPServices({operation:"GetList",async:false,listName:c(this).attr("List"),completefunc:function(C,B){c(C.responseXML).find("List").each(function(){u=c(this).attr("WebFullUrl")})}});c().SPServices({operation:"GetFormCollection",async:false,listName:c(this).attr("List"),completefunc:function(C,B){c(C.responseXML).find("Form").each(function(){if(c(this).attr("Type")=="NewForm"){y=c(this).attr("Url")}})}})}})}});if(y.length>0){newLink="<a href='"+u+"/"+y+"?Source="+k(location.href)+"'>"+x.promptText.replace(/\{0\}/g,x.lookupColumn)+"</a>";c(v.Obj).parents("td.ms-formbody").append(newLink)}};c.fn.SPServices.SPGetLastItemId=function(u){var w=c.extend({},{webURL:"",listName:"",userAccount:""},u);var v;var x=0;c().SPServices({operation:"GetUserInfo",async:false,userLoginName:(w.userAccount!="")?w.userAccount:c().SPServices.SPGetCurrentUser(),completefunc:function(z,y){c(z.responseXML).find("User").each(function(){v=c(this).attr("ID")})}});c().SPServices({operation:"GetListItems",async:false,webURL:w.webURL,listName:w.listName,CAMLQuery:"<Query><Where><Eq><FieldRef Name='Author' LookupId='TRUE'/><Value Type='Integer'>"+v+"</Value></Eq></Where><OrderBy><FieldRef Name='Created_x0020_Date' Ascending='FALSE'/></OrderBy></Query>",CAMLViewFields:"<ViewFields><FieldRef Name='ID'/></ViewFields>",CAMLRowLimit:1,completefunc:function(z,y){c(z.responseXML).find("[nodeName=z:row]").each(function(){x=c(this).attr("ows_ID")})}});return x};c.fn.SPServices.SPRequireUnique=function(w){var x=c.extend({},{columnStaticName:"Title",duplicateAction:0,ignoreCase:"false",initMsg:"This value must be unique.",initMsgCSSClass:"ms-vb",errMsg:"This value is not unique.",errMsgCSSClass:"ms-formvalidation"},w);var B="<span id='SPRequireUnique"+x.columnStaticName+"' class='{0}'>{1}<br/></span>";var u=B.replace(/\{0\}/g,x.initMsgCSSClass).replace(/\{1\}/g,x.initMsg);var A=B.replace(/\{0\}/g,x.errMsgCSSClass).replace(/\{1\}/g,x.errMsg);var z=o();var y=c().SPServices.SPGetDisplayFromStatic({listName:z,columnStaticName:x.columnStaticName});var v=c("input:[Title='"+y+"']");c(v).parent().append(u);c(v).change(function(){var D=0;var E=c(this).attr("value");c().SPServices({operation:"GetListItems",async:false,listName:o(),CAMLViewFields:"<ViewFields><FieldRef Name='"+y+"' /></ViewFields>",CAMLRowLimit:0,completefunc:function(H,F){var G=x.ignoreCase?E.toUpperCase():E;c(H.responseXML).find("[nodeName=z:row]").each(function(){var I=x.ignoreCase?c(this).attr("ows_"+x.columnStaticName).toUpperCase():c(this).attr("ows_"+x.columnStaticName);if(G==I){D++}})}});var C=u;c("input:[value='OK']").attr("disabled","");if(D>0){C=A;if(x.duplicateAction==1){c("input:[Title='"+x.columnDisplayName+"']").focus();c("input:[value='OK']").attr("disabled","disabled")}}c("span#SPRequireUnique"+x.columnStaticName).html(C)})};c.fn.SPServices.SPGetDisplayFromStatic=function(u){var w=c.extend({},{webURL:"",listName:"",columnStaticName:""},u);var v="";c().SPServices({operation:"GetList",async:false,webURL:w.webURL,listName:w.listName,completefunc:function(y,x){c(y.responseXML).find("Field").each(function(){if(c(this).attr("StaticName")==w.columnStaticName){displayName=c(this).attr("DisplayName")}})}});return displayName};c.fn.SPServices.SPRedirectWithID=function(v){var w=c.extend({},{redirectUrl:""},v);var x=o();var y=j();var z=y.ID;if(y.ID==undefined){z=c().SPServices.SPGetLastItemId({listName:x});c().find("form[name='aspnetForm']").each(function(){var A=(location.href.indexOf("?")>0)?location.href.substring(0,location.href.indexOf("?")):location.href;var B=(typeof y.Source=="string")?"Source="+y.Source.replace(/\//g,"%2f").replace(/:/g,"%3a"):"";var C=A+"?Source="+A+"?ID="+z+((B.length>0)?("%26RealSource="+y.Source):"")+((typeof y.RedirectURL=="string")?("%26RedirectURL="+y.RedirectURL):"");c(this).attr("action",C)})}else{while(y.ID==z){z=c().SPServices.SPGetLastItemId({listName:x})}var u=(typeof y.RedirectURL=="string")?y.RedirectURL:w.redirectUrl;location.href=u+"?ID="+z+((typeof y.RealSource=="string")?("&Source="+y.RealSource):"")}};function r(y,x,w){if(x==undefined){return""}var u;switch(y.attr("Type")){case"Text":u=x;break;case"URL":switch(y.attr("Format")){case"Hyperlink":u="<a href='"+x.substring(0,x.search(","))+"'>"+x.substring(x.search(",")+1)+"</a>";break;case"Image":u="<img alt='"+x.substring(x.search(",")+1)+"' src='"+x.substring(0,x.search(","))+"'/>";break;default:u=x;break}break;case"User":u="<a href='/_layouts/userdisp.aspx?ID="+x.substring(0,x.search(";#"))+"&Source="+k(location.href)+"'>"+x.substring(x.search(";#")+2)+"</a>";break;case"Number":u=parseFloat(x).toFixed(y.attr("Decimals")).toString();break;case"Lookup":var v;c().SPServices({operation:"GetFormCollection",async:false,listName:y.attr("List"),completefunc:function(A,z){c(A.responseXML).find("Form").each(function(){if(c(this).attr("Type")=="DisplayForm"){v=c(this).attr("Url")}})}});u="<a href='"+w.relatedWebURL+"/"+v+"?ID="+x.substring(0,x.search(";#"))+"&RootFolder=*'>"+x.substring(x.search(";#")+2)+"</a>";break;case"Counter":u=x;break;default:u=x;break}return u}function a(x,w){var u="<table class='ms-vb' width='100%'>";for(var v=0;v<x.attributes.length;v++){u+="<tr><td width='10px' style='font-weight:bold;'>"+v+"</td><td width='100px'>"+x.attributes.item(v).nodeName+"</td><td>"+n(x.attributes.item(v).nodeValue)+"</td></tr>"}u+="</table>";return u}function o(){var w=location.href;var v=w.substring(0,w.indexOf(".aspx"));var x=h(v.substring(0,v.lastIndexOf("/")));var u="";c().SPServices({operation:"GetListCollection",async:false,completefunc:function(z,y){c(z.responseXML).find("List").each(function(){var A=c(this).attr("DefaultViewUrl");var B=A.substring(0,A.lastIndexOf("/"));if(x.indexOf(B)>0){u=c(this).attr("ID")}})}});return u}function f(u){if((this.Obj=c().find("select:[Title='"+u+"']")).html()!=null){this.Type="S"}else{if((this.Obj=c().find("input:[Title='"+u+"']")).html()!=null){this.Type="C"}else{if((this.Obj=c().find("select:[Title='"+u+" possible values']")).html()!=null){this.Type="M"}else{this.Type=null}}}}function e(v,x,w){var u="<b>Error in function</b><br/>"+v+"<br/><b>Parameter</b><br/>"+x+"<br/><b>Message</b><br/>"+w+"<br/><br/><span style='width=100%;text-align:right;'>Click to continue</span></div>";m(u)}function m(z){var w="position:absolute;width:300px;height:150px;padding:10px;background-color:#000000;color:#ffffff;z-index:30;font-family:'Arial';font-size:12px;display:none;";c().find("#aspnetForm").parent().append("<div id='SPServices_msgBox' style="+w+">"+z);var u=c("#SPServices_msgBox").height();var y=c("#SPServices_msgBox").width();var x=(c(window).width()/2)-(y/2)+"px";var v=(c(window).height()/2)-(u/2)-100+"px";c("#SPServices_msgBox").css({border:"5px #C02000 solid",left:x,top:v}).show().fadeTo("slow",0.75).click(function(){c(this).fadeOut("3000",function(){c(this).remove()})})}function j(){var y=new Object();var u=location.search.substring(1,location.search.length);var w=u.split("&");for(var x=0;x<w.length;x++){var z=w[x].split("=");var v=unescape(z[1]).split("+");z[1]=v.join(" ");y[z[0]]=z[1]}return y}function n(u){return((u.indexOf("http")==0)||(u.indexOf("/")==0))?"<a href='"+u+"'>"+u+"</a>":u}function l(u){return u.replace(/"/g,"&quot;").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function h(v){return v.replace(/%20/g," ")}function k(v){return v.replace(/&/g,"%26")}function q(u){return u.replace(/ /g,"_x0020_")}function d(w,u){return"<"+w+">"+u+"</"+w+">"}})(jQuery);