/*
 * SPServices - Work with SharePoint's Web Services using jQuery
 * Version 0.4.7
 * @requires jQuery v1.3.2
 *
 * Copyright (c) 2009 Sympraxis Consulting LLC
 * Examples and docs at:
 * http://spservices.codeplex.com
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/mit-license.php
 */
/**
 * @description Work with SharePoint's Web Services using jQuery
 * @type jQuery
 * @name SPServices
 * @category Plugins/SPServices
 * @author Sympraxis Consulting LLC/marc.anderson@sympraxisconsulting.com
 */
(function(c){var q=new Array();q.Alerts="Alerts";q.Authentication="Authentication";q.Copy="Copy";q.Forms="Forms";q.Lists="Lists";q.Meetings="Meetings";q.Permissions="Permissions";q.PublishedLinksService="PublishedLinksService";q.Search="Search";q.usergroup="usergroup";q.UserProfileService="UserProfileService";q.Views="Views";q.Versions="Versions";q.WebPartPages="WebPartPages";q.Webs="Webs";q.Workflow="Workflow";var b=new Array();b.GetAlerts=q.Alerts;b.DeleteAlerts=q.Alerts;b.Mode=q.Authentication;b.Login=q.Authentication;b.CopyIntoItemsLocal=q.Copy;b.GetForm=q.Forms;b.GetFormCollection=q.Forms;b.AddList=q.Lists;b.CheckInFile=q.Lists;b.CheckOutFile=q.Lists;b.DeleteList=q.Lists;b.GetAttachmentCollection=q.Lists;b.GetList=q.Lists;b.GetListAndView=q.Lists;b.GetListCollection=q.Lists;b.GetListItems=q.Lists;b.UpdateList=q.Lists;b.UpdateListItems=q.Lists;b.AddMeeting=q.Meetings;b.CreateWorkspace=q.Meetings;b.RemoveMeeting=q.Meetings;b.SetWorkSpaceTitle=q.Meetings;b.GetPermissionCollection=q.Permissions;b.GetLinks=q.PublishedLinksService;b.GetPortalSearchInfo=q.Search;b.GetSearchMetadata=q.Search;b.Query=q.Search;b.Status=q.Search;b.AddGroup=q.usergroup;b.AddGroupToRole=q.usergroup;b.AddRole=q.usergroup;b.GetAllUserCollectionFromWeb=q.usergroup;b.GetGroupCollection=q.usergroup;b.GetGroupCollectionFromRole=q.usergroup;b.GetGroupCollectionFromSite=q.usergroup;b.GetGroupCollectionFromUser=q.usergroup;b.GetGroupCollectionFromWeb=q.usergroup;b.GetGroupInfo=q.usergroup;b.GetRoleCollection=q.usergroup;b.GetRoleCollectionFromGroup=q.usergroup;b.GetRoleCollectionFromUser=q.usergroup;b.GetRoleCollectionFromWeb=q.usergroup;b.GetRolesAndPermissionsForCurrentUser=q.usergroup;b.GetRolesAndPermissionsForSite=q.usergroup;b.GetUserCollection=q.usergroup;b.GetUserCollectionFromGroup=q.usergroup;b.GetUserCollectionFromRole=q.usergroup;b.GetUserCollectionFromSite=q.usergroup;b.GetUserCollectionFromWeb=q.usergroup;b.GetUserInfo=q.usergroup;b.GetUserLoginFromEmail=q.usergroup;b.RemoveGroup=q.usergroup;b.GetCommonMemberships=q.UserProfileService;b.GetUserColleagues=q.UserProfileService;b.GetUserLinks=q.UserProfileService;b.GetUserMemberships=q.UserProfileService;b.GetUserPinnedLinks=q.UserProfileService;b.GetUserProfileByName=q.UserProfileService;b.GetUserProfileCount=q.UserProfileService;b.GetUserProfileSchema=q.UserProfileService;b.GetViewCollection=q.Views;b.DeleteAllVersions=q.Versions;b.DeleteVersion=q.Versions;b.GetVersions=q.Versions;b.RestoreVersion=q.Versions;b.GetWebPart2=q.WebPartPages;b.GetWebPartPage=q.WebPartPages;b.GetWebPartProperties=q.WebPartPages;b.GetWebPartProperties2=q.WebPartPages;b.GetListTemplates=q.Webs;b.GetWeb=q.Webs;b.GetWebCollection=q.Webs;b.GetAllSubWebCollection=q.Webs;b.WebUrlFromPageUrl=q.Webs;b.GetTemplatesForItem=q.Workflow;b.GetToDosForItem=q.Workflow;b.GetWorkflowDataForItem=q.Workflow;b.GetWorkflowTaskData=q.Workflow;b.StartWorkflow=q.Workflow;var g=new Object();g.header="<soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body>";g.footer="</soap:Body></soap:Envelope>";g.payload="";c.fn.SPServices=function(v){var w=c.extend({},c.fn.SPServices.defaults,v);g.opheader="<"+w.operation+" ";switch(b[w.operation]){case q.Alerts:g.opheader+="xmlns='http://schemas.microsoft.com/sharepoint/soap/2002/1/alerts/' >";SOAPAction="http://schemas.microsoft.com/sharepoint/soap/2002/1/alerts/";break;case q.Meetings:g.opheader+="xmlns='http://schemas.microsoft.com/sharepoint/soap/meetings/' >";SOAPAction="http://schemas.microsoft.com/sharepoint/soap/meetings/";break;case q.Permissions:g.opheader+="xmlns='http://schemas.microsoft.com/sharepoint/soap/directory/' >";SOAPAction="http://schemas.microsoft.com/sharepoint/soap/directory/";break;case q.PublishedLinksService:g.opheader+="xmlns='http://microsoft.com/webservices/SharePointPortalServer/PublishedLinksService/' >";SOAPAction="http://microsoft.com/webservices/SharePointPortalServer/PublishedLinksService/";break;case q.Search:g.opheader+="xmlns='urn:Microsoft.Search' >";SOAPAction="urn:Microsoft.Search/";break;case q.usergroup:g.opheader+="xmlns='http://schemas.microsoft.com/sharepoint/soap/directory/' >";SOAPAction="http://schemas.microsoft.com/sharepoint/soap/directory/";break;case q.UserProfileService:g.opheader+="xmlns='http://microsoft.com/webservices/SharePointPortalServer/UserProfileService' >";SOAPAction="http://microsoft.com/webservices/SharePointPortalServer/UserProfileService/";break;case q.WebPartPages:g.opheader+="xmlns='http://microsoft.com/sharepoint/webpartpages' >";SOAPAction="http://microsoft.com/sharepoint/webpartpages/";break;case q.Workflow:g.opheader+="xmlns='http://schemas.microsoft.com/sharepoint/soap/workflow/' >";SOAPAction="http://schemas.microsoft.com/sharepoint/soap/workflow/";break;default:g.opheader+="xmlns='http://schemas.microsoft.com/sharepoint/soap/'>";SOAPAction="http://schemas.microsoft.com/sharepoint/soap/";break}SOAPAction+=w.operation;g.opfooter="</"+w.operation+">";var x=((w.webURL!="")?w.webURL:c().SPServices.SPGetCurrentSite())+"/_vti_bin/"+b[w.operation]+".asmx";g.payload="";switch(w.operation){case"GetAlerts":break;case"DeleteAlerts":g.payload+="<IDs>";for(i=0;i<w.IDs.length;i++){g.payload+=d("string",w.IDs[i])}g.payload+="</IDs>";break;case"Mode":break;case"Login":g.payload+=d("username",w.username);g.payload+=d("password",w.password);break;case"CopyIntoItemsLocal":g.payload+=d("SourceUrl",w.SourceUrl);g.payload+="<DestinationUrls>";for(i=0;i<w.DestinationUrls.length;i++){g.payload+=d("string",w.DestinationUrls[i])}g.payload+="</DestinationUrls>";break;case"GetForm":g.payload+=d("listName",w.listName);g.payload+=d("formUrl",w.formUrl);break;case"GetFormCollection":g.payload+=d("listName",w.listName);break;case"AddList":g.payload+=d("listName",w.listName);g.payload+=d("description",w.description);g.payload+=d("templateID",w.templateID);break;case"CheckInFile":g.payload+=d("pageUrl",w.pageUrl);g.payload+=d("comment",w.comment);g.payload+=d("CheckinType",w.CheckinType);break;case"CheckOutFile":g.payload+=d("pageUrl",w.pageUrl);g.payload+=d("checkoutToLocal",w.checkoutToLocal);g.payload+=d("lastmodified",w.lastmodified);break;case"DeleteList":g.payload+=d("listName",w.listName);break;case"GetAttachmentCollection":g.payload+=d("listName",w.listName);g.payload+=d("listItemID",w.ID);break;case"GetList":g.payload+=d("listName",w.listName);break;case"GetListAndView":g.payload+=d("listName",w.listName);g.payload+=d("viewName",w.viewName);break;case"GetListCollection":break;case"GetListItems":g.payload+=d("listName",w.listName);g.payload+=d("viewFields",w.CAMLViewFields);g.payload+=d("query",w.CAMLQuery);g.payload+=d("rowLimit",w.CAMLRowLimit);g.payload+=d("queryOptions",w.CAMLQueryOptions);break;case"UpdateList":g.payload+=d("listName",w.listName);g.payload+=d("listProperties",w.listProperties);g.payload+=d("newFields",w.newFields);g.payload+=d("updateFields",w.updateFields);g.payload+=d("deleteFields",w.deleteFields);g.payload+=d("listVersion",w.listVersion);break;case"UpdateListItems":g.payload+=d("listName",w.listName);if(w.updates.length>0){g.payload+=d("updates",w.updates)}else{g.payload+="<updates><Batch OnError='Continue'><Method ID='1' Cmd='"+w.batchCmd+"'>";for(i=0;i<w.valuepairs.length;i++){g.payload+="<Field Name='"+w.valuepairs[i][0]+"'>"+w.valuepairs[i][1]+"</Field>"}g.payload+="<Field Name='ID'>"+w.ID+"</Field>";g.payload+="</Method></Batch></updates>"}break;case"AddMeeting":g.payload+=d("organizerEmail",w.organizerEmail);g.payload+=d("uid",w.uid);g.payload+=d("sequence",w.sequence);g.payload+=d("utcDateStamp",w.utcDateStamp);g.payload+=d("title",w.title);g.payload+=d("location",w.location);g.payload+=d("utcDateStart",w.utcDateStart);g.payload+=d("utcDateEnd",w.utcDateEnd);g.payload+=d("nonGregorian",w.nonGregorian);break;case"CreateWorkspace":g.payload+=d("title",w.title);g.payload+=d("templateName",w.templateName);g.payload+=d("lcid",w.lcid);g.payload+=d("timeZoneInformation",w.timeZoneInformation);case"RemoveMeeting":g.payload+=d("recurrenceId",w.recurrenceId);g.payload+=d("uid",w.uid);g.payload+=d("sequence",w.sequence);g.payload+=d("utcDateStamp",w.utcDateStamp);g.payload+=d("cancelMeeting",w.cancelMeeting);case"SetWorkspaceTitle":g.payload+=d("title",w.title);case"GetPermissionCollection":g.payload+=d("objectName",w.objectName);g.payload+=d("objectType",w.objectType);break;case"GetLinks":break;case"GetPortalSearchInfo":SOAPAction="http://microsoft.com/webservices/OfficeServer/QueryService/"+w.operation;g.opheader="<"+w.operation+" xmlns='http://microsoft.com/webservices/OfficeServer/QueryService'/>";break;case"GetSearchMetadata":SOAPAction="http://microsoft.com/webservices/OfficeServer/QueryService/"+w.operation;g.opheader="<"+w.operation+" xmlns='http://microsoft.com/webservices/OfficeServer/QueryService'/>";break;case"Query":g.payload+=d("queryXml",m(w.queryXml));break;case"Status":break;case"AddGroup":g.payload+=d("groupName",w.groupName);g.payload+=d("ownerIdentifier",w.ownerIdentifier);g.payload+=d("ownerType",w.ownerType);g.payload+=d("defaultUserLoginName",w.defaultUserLoginName);g.payload+=d("groupName",w.groupName);g.payload+=d("description",w.description);break;case"AddGroupToRole":g.payload+=d("groupName",w.groupName);g.payload+=d("roleName",w.roleName);break;case"AddRole":g.payload+=d("roleName",w.roleName);g.payload+=d("description",w.description);g.payload+=d("permissionMask",w.permissionMask);break;case"GetAllUserCollectionFromWeb":break;case"GetGroupCollectionFromRole":g.payload+=d("roleName",w.roleName);break;case"GetGroupCollection":g.payload+=d("groupNamesXml",w.groupNamesXml);break;case"GetGroupCollectionFromSite":break;case"GetGroupCollectionFromUser":g.payload+=d("userLoginName",w.userLoginName);break;case"GetGroupCollectionFromWeb":break;case"GetGroupInfo":g.payload+=d("groupName",w.groupName);break;case"GetRoleCollection":g.payload+=d("roleNamesXml",w.roleNamesXml);break;case"GetRoleCollectionFromGroup":g.payload+=d("groupName",w.groupName);break;case"GetRoleCollectionFromUser":g.payload+=d("userLoginName",w.userLoginName);break;case"GetRoleCollectionFromWeb":break;case"GetRoleInfo":g.payload+=d("roleName",w.roleName);break;case"GetRolesAndPermissionsForCurrentUser":break;case"GetRolesAndPermissionsForSite":break;case"GetUserCollection":g.payload+=d("userLoginNamesXml",w.userLoginNamesXml);break;case"GetUserCollectionFromGroup":g.payload+=d("groupName",w.groupName);break;case"GetUserCollectionFromRole":g.payload+=d("roleName",w.roleName);break;case"GetUserCollectionFromSite":break;case"GetUserCollectionFromWeb":break;case"GetUserInfo":g.payload+=d("userLoginName",w.userLoginName);break;case"GetUserLoginFromEmail":g.payload+=d("emailXml",w.emailXml);break;case"RemoveGroup":g.payload+=d("groupName",w.groupName);break;case"GetCommonMemberships":g.payload+=d("accountName",w.accountName);break;case"GetUserColleagues":g.payload+=d("accountName",w.accountName);break;case"GetUserLinks":g.payload+=d("accountName",w.accountName);break;case"GetUserMemberships":g.payload+=d("accountName",w.accountName);break;case"GetUserPinnedLinks":g.payload+=d("accountName",w.accountName);break;case"GetUserProfileByName":if(w.accountName.length>0){g.payload+=d("AccountName",w.accountName)}else{g.payload+=d("AccountName",w.AccountName)}break;case"GetUserProfileCount":break;case"GetUserProfileSchema":break;case"GetViewCollection":g.payload+=d("listName",w.listName);break;case"DeleteAllVersions":g.payload+=d("fileName",w.fileName);break;case"DeleteVersion":g.payload+=d("fileName",w.fileName);g.payload+=d("fileVersion",w.fileVersion);break;case"GetVersions":g.payload+=d("fileName",w.fileName);break;case"RestoreVersion":g.payload+=d("fileName",w.fileName);g.payload+=d("fileVersion",w.fileVersion);break;case"GetWebPart2":g.payload+=d("pageUrl",w.pageUrl);g.payload+=d("storageKey",w.storageKey);g.payload+=d("storage",w.storage);g.payload+=d("behavior",w.behavior);break;case"GetWebPartPage":g.payload+=d("documentName",w.documentName);g.payload+=d("behavior",w.behavior);break;case"GetWebPartProperties":g.payload+=d("pageUrl",w.pageUrl);g.payload+=d("storage",w.storage);break;case"GetWebPartProperties2":g.payload+=d("pageUrl",w.pageUrl);g.payload+=d("storage",w.storage);g.payload+=d("behavior",w.behavior);break;case"GetWeb":g.payload+=d("webUrl",w.webURL);break;case"GetListTemplates":break;case"GetWebCollection":break;case"GetAllSubWebCollection":break;case"WebUrlFromPageUrl":g.payload+=d("pageUrl",w.pageURL);break;case"GetTemplatesForItem":g.payload+=d("item",w.item);break;case"GetToDosForItem":g.payload+=d("item",w.item);break;case"GetWorkflowDataForItem":g.payload+=d("item",w.item);break;case"GetWorkflowTaskData":g.payload+=d("item",w.item);g.payload+=d("listId",w.listId);g.payload+=d("taskId",w.taskId);break;case"StartWorkflow":g.payload+=d("item",w.item);g.payload+=d("templateId",w.templateId);g.payload+=d("workflowParameters",w.workflowParameters);break;default:break}var y=g.header+g.opheader+g.payload+g.opfooter+g.footer;c.ajax({url:x,async:w.async,beforeSend:function(z){z.setRequestHeader("SOAPAction",SOAPAction)},type:"POST",data:y,dataType:"xml",contentType:"text/xml; charset='utf-8'",complete:w.completefunc})};c.fn.SPServices.defaults={operation:"",webURL:"",pageURL:"",listName:"",description:"",templateID:"",viewName:"",formUrl:"",fileName:"",fileVersion:"",ID:1,updates:"",comment:"",CheckinType:"",checkoutToLocal:"",lastmodified:"",CAMLViewName:"",CAMLQuery:"",CAMLViewFields:"",CAMLRowLimit:0,CAMLQueryOptions:"<QueryOptions></QueryOptions>",batchCmd:"Update",valuepairs:[],listProperties:"",newFields:"",updateFields:"",deleteFields:"",listVersion:"",username:"",password:"",accountName:"",AccountName:"",userLoginName:"",groupNamesXml:"",groupName:"",ownerIdentifier:"",ownerType:"",defaultUserLoginName:"",roleNamesXml:"",roleName:"",permissionMask:"",userLoginNamesXml:"",emailXml:"",objectName:"",objectType:"List",IDs:null,SourceUrl:"",DestinationUrls:[],documentName:"",behavior:"Version3",storageKey:"",storage:"Shared",item:"",listId:"",taskId:"",templateId:"",workflowParameters:"",fClaim:false,queryXml:"",cancelMeeting:true,lcid:"",location:"",nonGregorian:false,organizerEmail:"",recurrenceId:0,sequence:0,templateName:"",timeZoneInformation:"",title:"",uid:"",utcDateStamp:"",utcDateStart:"",utcDateEnd:"",async:true,completefunc:null};c.fn.SPServices.SPGetCurrentSite=function(){var v="";var w=g.header+"<WebUrlFromPageUrl xmlns='http://schemas.microsoft.com/sharepoint/soap/' ><pageUrl>"+((location.href.indexOf("?")>0)?location.href.substr(0,location.href.indexOf("?")):location.href)+"</pageUrl></WebUrlFromPageUrl>"+g.footer;c.ajax({async:false,url:"/_vti_bin/Webs.asmx",beforeSend:function(x){x.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/WebUrlFromPageUrl")},type:"POST",data:w,dataType:"xml",contentType:'text/xml; charset="utf-8"',complete:function(y,x){v=c(y.responseXML).find("WebUrlFromPageUrlResult").text()}});return v};c.fn.SPServices.SPCascadeDropdowns=function(v){var x=c.extend({},{relationshipWebURL:"",relationshipList:"",relationshipListParentColumn:"",relationshipListChildColumn:"",relationshipListSortColumn:"",parentColumn:"",childColumn:"",CAMLQuery:"",completefunc:null,debug:false},v);var w=new f(x.parentColumn);if(w.Obj.html()==null&&x.debug){e("SPServices.SPCascadeDropdowns","parentColumn: "+x.parentColumn,"Column not found on page");return}switch(w.Type){case"S":w.Obj.bind("change",function(){t(x)});w.Obj.change();break;case"C":w.Obj.bind("propertychange",function(){t(x)});w.Obj.trigger("propertychange");break;case"M":w.Obj.bind("dblclick",function(){t(x)});parentSelections=w.Obj.closest("span").find("select:[Title='"+x.parentColumn+" selected values']");parentSelections.bind("dblclick",function(){t(x)});w.Obj.closest("span").find("button").each(function(){c(this).bind("click",function(){t(x)})});t(x);break;default:break}};function t(y){var G="";var C=null;var A=[];var x;var D;var E;var B=new f(y.parentColumn);switch(B.Type){case"S":A.push(B.Obj.find("option:selected").text());break;case"C":A.push(B.Obj.attr("value"));break;case"M":parentSelections=B.Obj.closest("span").find("select:[Title='"+y.parentColumn+" selected values']");c(parentSelections).find("option").each(function(){A.push(c(this).html())});break;default:break}if(B.Obj.attr("cascadeDropdownSelected_"+y.childColumn)==A.join(";#")){return}B.Obj.attr("cascadeDropdownSelected_"+y.childColumn,A.join(";#"));var w=new f(y.childColumn);if(w.Obj.html()==null&&y.debug){e("SPServices.SPCascadeDropdowns","childColumn: "+y.childColumn,"Column not found on page");return}switch(w.Type){case"S":C=w.Obj.find("option:selected").val();break;case"C":C=w.Obj.attr("value");break;case"M":D=w.Obj.closest("span").find("input:[name$='MultiLookupPicker$data']");x=window[w.Obj.closest("tr").find("button:[id$='AddButton']").attr("id").replace(/AddButton/,"MultiLookupPicker_m")];currentSelection=w.Obj.closest("span").find("select:[Title='"+y.childColumn+" selected values']");x.data="";break;default:break}var z=(y.relationshipListSortColumn.length>0)?y.relationshipListSortColumn:y.relationshipListChildColumn;var v="<Query><OrderBy><FieldRef Name='"+z+"'/></OrderBy><Where>";if(y.CAMLQuery.length>0){v+="<And>"}if(A.length==0){v+="<Eq><FieldRef Name='"+y.relationshipListParentColumn+"'/><Value Type='Text'></Value></Eq>"}else{if(A.length==1){v+="<Eq><FieldRef Name='"+y.relationshipListParentColumn+"'/><Value Type='Text'>"+j(A[0])+"</Value></Eq>"}else{var F=(A.length>2)?true:false;for(i=0;i<(A.length-1);i++){v+="<Or>"}for(i=0;i<A.length;i++){v+="<Eq><FieldRef Name='"+y.relationshipListParentColumn+"'/><Value Type='Text'>"+j(A[i])+"</Value></Eq>";if(i>0&&(i<(A.length-1))&&F){v+="</Or>"}}v+="</Or>"}}if(y.CAMLQuery.length>0){v+=y.CAMLQuery+"</And>"}v+="</Where></Query>";c().SPServices({operation:"GetListItems",async:false,webURL:y.relationshipWebURL,listName:y.relationshipList,CAMLQuery:v,CAMLViewFields:"<ViewFields><FieldRef Name='"+y.relationshipListParentColumn+"' /><FieldRef Name='"+y.relationshipListChildColumn+"' /></ViewFields>",CAMLRowLimit:0,completefunc:function(I,H){c(I.responseXML).find("faultcode").each(function(){if(y.debug){e("SPServices.SPCascadeDropdowns","relationshipListParentColumn: "+y.relationshipListParentColumn+" or relationshipListChildColumn: "+y.relationshipListChildColumn,"Not found in relationshipList "+y.relationshipList)}return});switch(w.Type){case"S":w.Obj.attr({length:0}).append("<option value='0'>Choose "+y.childColumn+"...</option>");break;case"C":G="(None)|0";w.Obj.attr("value","");break;case"M":w.Obj.attr({length:0});E="";break;default:break}c(I.responseXML).find("[nodeName=z:row]").each(function(){var K=(c(this).attr("ows_"+y.relationshipListChildColumn).indexOf(";#")>0)?c(this).attr("ows_"+y.relationshipListChildColumn).split(";#")[0]:c(this).attr("ows_ID");var J=(c(this).attr("ows_"+y.relationshipListChildColumn).indexOf(";#")>0)?c(this).attr("ows_"+y.relationshipListChildColumn).split(";#")[1]:c(this).attr("ows_"+y.relationshipListChildColumn);switch(w.Type){case"S":var L=(c(this).attr("ows_ID")==C)?" selected='selected'":"";w.Obj.append("<option"+L+" value='"+K+"'>"+J+"</option>");break;case"C":if(J==C){w.Obj.attr("value",C)}G=G+"|"+J+"|"+K;break;case"M":w.Obj.append("<option value='"+K+"'>"+J+"</option>");E+=K+"|t"+J+"|t |t |t";break;default:break}});switch(w.Type){case"S":w.Obj.trigger("change");break;case"C":w.Obj.attr("choices",G);w.Obj.trigger("propertychange");break;case"M":D.attr("value",E);c(currentSelection).find("option").each(function(){var J=c(this);c(this).attr("selected","selected");c(w.Obj).find("option").each(function(){if(c(this).html()==J.html()){J.attr("selected","")}})});GipRemoveSelectedItems(x);c(w.Obj).find("option").each(function(){var J=c(this);c(currentSelection).find("option").each(function(){if(c(this).html()==J.html()){J.remove()}})});GipAddSelectedItems(x);x.data=GipGetGroupData(E);break;default:break}}});if(y.completefunc!=null){y.completefunc()}}c.fn.SPServices.SPDisplayRelatedInfo=function(v){var w=c.extend({},{columnName:"",relatedWebURL:"",relatedList:"",relatedListColumn:"",relatedColumns:[],displayFormat:"table",headerCSSClass:"ms-vh2",rowCSSClass:"ms-vb",CAMLQuery:"",numChars:0,matchType:"Eq",completefunc:null,debug:false},v);var x=new f(w.columnName);if(x.Obj.html()==null&&w.debug){e("SPServices.SPDisplayRelatedInfo","columnName: "+w.columnName,"Column not found on page");return}switch(x.Type){case"S":x.Obj.bind("change",function(){u(w)});x.Obj.change();break;case"C":x.Obj.bind("propertychange",function(){u(w)});x.Obj.trigger("propertychange");break;case"M":if(w.debug){e("SPServices.SPDisplayRelatedInfo","columnName: "+w.columnName,"Multi-select columns not supported by this function")}break;default:break}};function u(A){var w=null;var B=new f(A.columnName);switch(B.Type){case"S":w=B.Obj.find("option:selected").text();break;case"C":w=B.Obj.attr("value");if(A.numChars>0&&w.length<A.numChars){return}break;case"M":break;default:break}if(B.Obj.attr("showRelatedSelected")==w){return}B.Obj.attr("showRelatedSelected",w);var y="showRelated_"+r(A.columnName);c("#"+y).remove();B.Obj.parent().append("<div id="+y+"></div>");var z=[];c().SPServices({operation:"GetList",async:false,webURL:A.relatedWebURL,listName:A.relatedList,completefunc:function(D,C){c(D.responseXML).find("faultcode").each(function(){if(A.debug){e("SPServices.SPDisplayRelatedInfo","relatedList: "+A.relatedList,"List not found")}return});c(D.responseXML).find("Fields").each(function(){c(D.responseXML).find("Field").each(function(){for(i=0;i<A.relatedColumns.length;i++){if(c(this).attr("Name")==A.relatedColumns[i]){z[i]=c(this)}}})})}});var v="<Query><Where>";if(A.CAMLQuery.length>0){v+="<And>"}v+="<"+A.matchType+"><FieldRef Name='"+A.relatedListColumn+"'/><Value Type='Text'>"+j(w)+"</Value></"+A.matchType+">";if(A.CAMLQuery.length>0){v+=A.CAMLQuery+"</And>"}v+="</Where></Query>";var x=" ";for(i=0;i<A.relatedColumns.length;i++){x+="<FieldRef Name='"+A.relatedColumns[i]+"' />"}c().SPServices({operation:"GetListItems",async:false,webURL:A.relatedWebURL,listName:A.relatedList,CAMLQuery:v,CAMLViewFields:"<ViewFields>"+x+"</ViewFields>",CAMLRowLimit:0,completefunc:function(E,D){c(E.responseXML).find("faultcode").each(function(){if(A.debug){e("SPServices.SPDisplayRelatedInfo","relatedListColumn: "+A.relatedListColumn,"Column not found in relatedList "+A.relatedList)}return});switch(A.displayFormat){case"table":var C="<table>";C+="<tr>";for(i=0;i<A.relatedColumns.length;i++){if(z[i]==undefined&&A.debug){e("SPServices.SPDisplayRelatedInfo","columnName: "+A.relatedColumns[i],"Column not found in relatedList");return}C+="<th class='"+A.headerCSSClass+"'>"+z[i].attr("DisplayName")+"</th>"}C+="</tr>";c(E.responseXML).find("[nodeName=z:row]").each(function(){C+="<tr>";for(i=0;i<A.relatedColumns.length;i++){C+="<td class='"+A.rowCSSClass+"'>"+s(z[i],c(this).attr("ows_"+A.relatedColumns[i]),A)+"</td>"}C+="</tr>"});C+="</table>";c("#showRelated_"+r(A.columnName)).html("").append(C);break;case"list":var C="<table>";for(i=0;i<A.relatedColumns.length;i++){c(E.responseXML).find("[nodeName=z:row]").each(function(){C+="<tr>";C+="<th class='"+A.headerCSSClass+"'>"+z[i].attr("DisplayName")+"</th>";C+="<td class='"+A.rowCSSClass+"'>"+s(z[i],c(this).attr("ows_"+A.relatedColumns[i]),A)+"</td>";C+="</tr>"})}C+="</table>";c("#showRelated_"+r(A.columnName)).html("").append(C);break;default:break}}});if(A.completefunc!=null){A.completefunc()}}c.fn.SPServices.SPDebugXMLHttpResult=function(w){var y=c.extend({},{node:null,indent:0},w);var A=3;var z=4;var v="";v+="<table class='ms-vb' style='margin-left:"+y.indent*3+"px;' width='100%'>";if(y.node.nodeName=="DisplayPattern"){v+="<tr><td width='100px' style='font-weight:bold;'>"+y.node.nodeName+"</td><td><textarea readonly='readonly' rows='5' cols='50'>"+y.node.xml+"</textarea></td></tr>"}else{if(!y.node.hasChildNodes()){v+="<tr><td width='100px' style='font-weight:bold;'>"+y.node.nodeName+"</td><td>"+((y.node.nodeValue!=null)?o(y.node.nodeValue):"&nbsp;")+"</td></tr>";if(y.node.attributes){v+="<tr><td colspan='99'>";v+=a(y.node,y);v+="</td></tr>"}}else{if(y.node.hasChildNodes()&&y.node.firstChild.nodeType==z){v+="<tr><td width='100px' style='font-weight:bold;'>"+y.node.nodeName+"</td><td><textarea readonly='readonly' rows='5' cols='50'>"+y.node.parentNode.text+"</textarea></td></tr>"}else{if(y.node.hasChildNodes()&&y.node.firstChild.nodeType==A){v+="<tr><td width='100px' style='font-weight:bold;'>"+y.node.nodeName+"</td><td>"+o(y.node.firstChild.nodeValue)+"</td></tr>"}else{v+="<tr><td width='100px' style='font-weight:bold;' colspan='99'>"+y.node.nodeName+"</td></tr>";if(y.node.attributes){v+="<tr><td colspan='99'>";v+=a(y.node,y);v+="</td></tr>"}v+="<tr><td>";for(var x=0;x<y.node.childNodes.length;x++){v+=c().SPServices.SPDebugXMLHttpResult({node:y.node.childNodes.item(x),indent:y.indent+1})}v+="</td></tr>"}}}}v+="</table>";return v};c.fn.SPServices.SPGetCurrentUser=function(){var v="";c.ajax({async:false,url:"/_layouts/userdisp.aspx?Force=True",complete:function(x,w){c(x.responseText).find("table.ms-formtable td#SPFieldText").each(function(){if(/FieldInternalName=\"Name\"/.test(c(this).html())){v=c(this).text()}})}});return v.replace(/(^[\s\xA0]+|[\s\xA0]+$)/g,"")};c.fn.SPServices.SPLookupAddNew=function(x){var y=c.extend({},{lookupColumn:"",promptText:"Add new {0}",completefunc:null,debug:false},x);var w=new f(y.lookupColumn);if(w.Obj.html()==null&&y.debug){e("SPServices.SPLookupAddNew","lookupColumn: "+y.lookupColumn,"Column not found on page");return}var z="";var v="";c().SPServices({operation:"GetList",async:false,listName:p(),completefunc:function(B,A){c(B.responseXML).find("Field").each(function(){if(c(this).attr("DisplayName")==y.lookupColumn){c().SPServices({operation:"GetList",async:false,listName:c(this).attr("List"),completefunc:function(D,C){c(D.responseXML).find("List").each(function(){v=c(this).attr("WebFullUrl")})}});c().SPServices({operation:"GetFormCollection",async:false,listName:c(this).attr("List"),completefunc:function(D,C){c(D.responseXML).find("Form").each(function(){if(c(this).attr("Type")=="NewForm"){z=c(this).attr("Url")}})}})}})}});if(v.length==0&&y.debug){e("SPServices.SPLookupAddNew","lookupColumn: "+y.lookupColumn,"This column does not appear to be a lookup column");return}if(z.length>0){newLink="<a href='"+v+"/"+z+"?Source="+l(location.href)+"'>"+y.promptText.replace(/\{0\}/g,y.lookupColumn)+"</a>";c(w.Obj).parents("td.ms-formbody").append(newLink)}else{if(y.debug){e("SPServices.SPLookupAddNew","lookupColumn: "+y.lookupColumn,"NewForm cannot be found");return}}if(y.completefunc!=null){y.completefunc()}};c.fn.SPServices.SPGetLastItemId=function(v){var x=c.extend({},{webURL:"",listName:"",userAccount:""},v);var w;var y=0;c().SPServices({operation:"GetUserInfo",async:false,userLoginName:(x.userAccount!="")?x.userAccount:c().SPServices.SPGetCurrentUser(),completefunc:function(A,z){c(A.responseXML).find("User").each(function(){w=c(this).attr("ID")})}});c().SPServices({operation:"GetListItems",async:false,webURL:x.webURL,listName:x.listName,CAMLQuery:"<Query><Where><Eq><FieldRef Name='Author' LookupId='TRUE'/><Value Type='Integer'>"+w+"</Value></Eq></Where><OrderBy><FieldRef Name='Created_x0020_Date' Ascending='FALSE'/></OrderBy></Query>",CAMLViewFields:"<ViewFields><FieldRef Name='ID'/></ViewFields>",CAMLRowLimit:1,completefunc:function(A,z){c(A.responseXML).find("[nodeName=z:row]").each(function(){y=c(this).attr("ows_ID")})}});return y};c.fn.SPServices.SPRequireUnique=function(x){var y=c.extend({},{columnStaticName:"Title",duplicateAction:0,ignoreCase:"false",initMsg:"This value must be unique.",initMsgCSSClass:"ms-vb",errMsg:"This value is not unique.",errMsgCSSClass:"ms-formvalidation",completefunc:null},x);var C="<span id='SPRequireUnique"+y.columnStaticName+"' class='{0}'>{1}<br/></span>";var v=C.replace(/\{0\}/g,y.initMsgCSSClass).replace(/\{1\}/g,y.initMsg);var B=C.replace(/\{0\}/g,y.errMsgCSSClass).replace(/\{1\}/g,y.errMsg);var A=p();var z=c().SPServices.SPGetDisplayFromStatic({listName:A,columnStaticName:y.columnStaticName});var w=c("input:[Title='"+z+"']");c(w).parent().append(v);c(w).change(function(){var E=0;var F=c(this).attr("value");c().SPServices({operation:"GetListItems",async:false,listName:p(),CAMLViewFields:"<ViewFields><FieldRef Name='"+z+"' /></ViewFields>",CAMLRowLimit:0,completefunc:function(I,G){var H=y.ignoreCase?F.toUpperCase():F;c(I.responseXML).find("[nodeName=z:row]").each(function(){var J=y.ignoreCase?c(this).attr("ows_"+y.columnStaticName).toUpperCase():c(this).attr("ows_"+y.columnStaticName);if(H==J){E++}})}});var D=v;c("input:[value='OK']").attr("disabled","");if(E>0){D=B;if(y.duplicateAction==1){c("input:[Title='"+y.columnDisplayName+"']").focus();c("input:[value='OK']").attr("disabled","disabled")}}c("span#SPRequireUnique"+y.columnStaticName).html(D)});if(y.completefunc!=null){y.completefunc()}};c.fn.SPServices.SPGetDisplayFromStatic=function(v){var x=c.extend({},{webURL:"",listName:"",columnStaticName:""},v);var w="";c().SPServices({operation:"GetList",async:false,webURL:x.webURL,listName:x.listName,completefunc:function(z,y){c(z.responseXML).find("Field").each(function(){if(c(this).attr("StaticName")==x.columnStaticName){displayName=c(this).attr("DisplayName")}})}});return displayName};c.fn.SPServices.SPRedirectWithID=function(w){var x=c.extend({},{redirectUrl:""},w);var y=p();var z=k();var A=z.ID;if(z.ID==undefined){A=c().SPServices.SPGetLastItemId({listName:y});c().find("form[name='aspnetForm']").each(function(){var B=(location.href.indexOf("?")>0)?location.href.substring(0,location.href.indexOf("?")):location.href;var C=(typeof z.Source=="string")?"Source="+z.Source.replace(/\//g,"%2f").replace(/:/g,"%3a"):"";var D=B+"?Source="+B+"?ID="+A+((C.length>0)?("%26RealSource="+z.Source):"")+((typeof z.RedirectURL=="string")?("%26RedirectURL="+z.RedirectURL):"");c(this).attr("action",D)})}else{while(z.ID==A){A=c().SPServices.SPGetLastItemId({listName:y})}var v=(typeof z.RedirectURL=="string")?z.RedirectURL:x.redirectUrl;location.href=v+"?ID="+A+((typeof z.RealSource=="string")?("&Source="+z.RealSource):"")}};function s(A,z,y){if(z==undefined){return""}var v;switch(A.attr("Type")){case"Text":v=z;break;case"URL":switch(A.attr("Format")){case"Hyperlink":v="<a href='"+z.substring(0,z.search(","))+"'>"+z.substring(z.search(",")+1)+"</a>";break;case"Image":v="<img alt='"+z.substring(z.search(",")+1)+"' src='"+z.substring(0,z.search(","))+"'/>";break;default:v=z;break}break;case"User":v="<a href='/_layouts/userdisp.aspx?ID="+z.substring(0,z.search(";#"))+"&Source="+l(location.href)+"'>"+z.substring(z.search(";#")+2)+"</a>";break;case"Calculated":var w=z.split(";#");v=w[1];break;case"Number":v=parseFloat(z).toFixed(A.attr("Decimals")).toString();break;case"Lookup":var x;c().SPServices({operation:"GetFormCollection",async:false,listName:A.attr("List"),completefunc:function(C,B){c(C.responseXML).find("Form").each(function(){if(c(this).attr("Type")=="DisplayForm"){x=c(this).attr("Url")}})}});v="<a href='"+y.relatedWebURL+"/"+x+"?ID="+z.substring(0,z.search(";#"))+"&RootFolder=*'>"+z.substring(z.search(";#")+2)+"</a>";break;case"Counter":v=z;break;default:v=z;break}return v}function a(y,x){var v="<table class='ms-vb' width='100%'>";for(var w=0;w<y.attributes.length;w++){v+="<tr><td width='10px' style='font-weight:bold;'>"+w+"</td><td width='100px'>"+y.attributes.item(w).nodeName+"</td><td>"+o(y.attributes.item(w).nodeValue)+"</td></tr>"}v+="</table>";return v}function p(){var x=location.href;var w=x.substring(0,x.indexOf(".aspx"));var y=h(w.substring(0,w.lastIndexOf("/")));var v="";c().SPServices({operation:"GetListCollection",async:false,completefunc:function(A,z){c(A.responseXML).find("List").each(function(){var B=c(this).attr("DefaultViewUrl");var C=B.substring(0,B.lastIndexOf("/"));if(y.indexOf(C)>0){v=c(this).attr("ID")}})}});return v}function f(v){if((this.Obj=c().find("select:[Title='"+v+"']")).html()!=null){this.Type="S"}else{if((this.Obj=c().find("input:[Title='"+v+"']")).html()!=null){this.Type="C"}else{if((this.Obj=c().find("select:[Title='"+v+" possible values']")).html()!=null){this.Type="M"}else{this.Type=null}}}}function e(w,y,x){var v="<b>Error in function</b><br/>"+w+"<br/><b>Parameter</b><br/>"+y+"<br/><b>Message</b><br/>"+x+"<br/><br/><span style='width=100%;text-align:right;'>Click to continue</span></div>";n(v)}function n(A){var x="position:absolute;width:300px;height:150px;padding:10px;background-color:#000000;color:#ffffff;z-index:30;font-family:'Arial';font-size:12px;display:none;";c().find("#aspnetForm").parent().append("<div id='SPServices_msgBox' style="+x+">"+A);var v=c("#SPServices_msgBox").height();var z=c("#SPServices_msgBox").width();var y=(c(window).width()/2)-(z/2)+"px";var w=(c(window).height()/2)-(v/2)-100+"px";c("#SPServices_msgBox").css({border:"5px #C02000 solid",left:y,top:w}).show().fadeTo("slow",0.75).click(function(){c(this).fadeOut("3000",function(){c(this).remove()})})}function k(){var z=new Object();var v=location.search.substring(1,location.search.length);var x=v.split("&");for(var y=0;y<x.length;y++){var A=x[y].split("=");var w=unescape(A[1]).split("+");A[1]=w.join(" ");z[A[0]]=A[1]}return z}function o(v){return((v.indexOf("http")==0)||(v.indexOf("/")==0))?"<a href='"+v+"'>"+v+"</a>":v}function m(v){return v.replace(/"/g,"&quot;").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function j(v){return v.replace(/&/g,"&amp;")}function h(v){return v.replace(/%20/g," ")}function l(v){return v.replace(/&/g,"%26")}function r(v){return v.replace(/ /g,"_x0020_")}function d(x,w){return"<"+x+">"+w+"</"+x+">"}})(jQuery);